(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory();else if(typeof define==='function'&&define.amd)
define([],factory);else if(typeof exports==='object')
exports["MidiConvert"]=factory();else
root["MidiConvert"]=factory();})(this,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports;}
var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value;};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter});}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default'];}:function getModuleExports(){return module;};__webpack_require__.d(getter,'a',getter);return getter;};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=7);})
([(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__["b"]=cleanName;__webpack_exports__["a"]=ticksToSeconds;__webpack_exports__["c"]=isNumber;__webpack_require__.d(__webpack_exports__,"d",function(){return isPitch;});__webpack_exports__["e"]=midiToPitch;__webpack_require__.d(__webpack_exports__,"f",function(){return pitchToMidi;});function cleanName(str){return str.replace(/\u0000/g,'');}
function ticksToSeconds(ticks,header){return 60/header.bpm*(ticks/header.PPQ);}
function isNumber(val){return typeof val==='number';}
function isString(val){return typeof val==='string';}
var isPitch=function(){var regexp=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i;return function(val){return isString(val)&&regexp.test(val);};}();function midiToPitch(midi){var scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var octave=Math.floor(midi/12)-1;var note=midi%12;return scaleIndexToNote[note]+octave;}
var pitchToMidi=function(){var regexp=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i;var noteToScaleIndex={"cbb":-2,"cb":-1,"c":0,"c#":1,"cx":2,"dbb":0,"db":1,"d":2,"d#":3,"dx":4,"ebb":2,"eb":3,"e":4,"e#":5,"ex":6,"fbb":3,"fb":4,"f":5,"f#":6,"fx":7,"gbb":5,"gb":6,"g":7,"g#":8,"gx":9,"abb":7,"ab":8,"a":9,"a#":10,"ax":11,"bbb":9,"bb":10,"b":11,"b#":12,"bx":13};return function(note){var split=regexp.exec(note);var pitch=split[1];var octave=split[2];var index=noteToScaleIndex[pitch.toLowerCase()];return index+(parseInt(octave)+1)*12;};}();}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return instrumentByPatchID;});__webpack_require__.d(__webpack_exports__,"b",function(){return instrumentFamilyByID;});__webpack_require__.d(__webpack_exports__,"c",function(){return drumKitByPatchID;});var instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];var instrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","ethnic","percussive","sound effects"];var drumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Midi;});var __WEBPACK_IMPORTED_MODULE_0_midi_file_parser__=__webpack_require__(11);var __WEBPACK_IMPORTED_MODULE_0_midi_file_parser___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_midi_file_parser__);var __WEBPACK_IMPORTED_MODULE_1_jsmidgen__=__webpack_require__(10);var __WEBPACK_IMPORTED_MODULE_1_jsmidgen___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_jsmidgen__);var __WEBPACK_IMPORTED_MODULE_2__Util__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_3__Track__=__webpack_require__(9);var __WEBPACK_IMPORTED_MODULE_4__Header__=__webpack_require__(5);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Midi=function(){_createClass(Midi,null,[{key:'fromJSON',value:function fromJSON(json){var midi=new Midi();midi.header=json.header;json.tracks.forEach(function(track){var newTrack=__WEBPACK_IMPORTED_MODULE_3__Track__["a"].fromJSON(track);midi.tracks.push(newTrack);});return midi;}}]);function Midi(){_classCallCheck(this,Midi);this.header={bpm:120,timeSignature:[4,4],PPQ:480};this.tracks=[];}
_createClass(Midi,[{key:'load',value:function load(url){var _this=this;var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var method=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'GET';return new Promise(function(success,fail){var request=new XMLHttpRequest();request.open(method,url);request.responseType='arraybuffer';request.addEventListener('load',function(){if(request.readyState===4&&request.status===200){success(_this.decode(request.response));}else{fail(request.status);}});request.addEventListener('error',fail);request.send(data);}).catch(function(error){console.log(error);});}},{key:'decode',value:function decode(bytes){var _this2=this;if(bytes instanceof ArrayBuffer){var byteArray=new Uint8Array(bytes);bytes=String.fromCharCode.apply(null,byteArray);}
var midiData=__WEBPACK_IMPORTED_MODULE_0_midi_file_parser__(bytes);this.header=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__Header__["a"])(midiData);this.tempo=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__Header__["b"])(midiData,this.header);this.timeSign=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4__Header__["c"])(midiData,this.header);this.tracks=[];midiData.tracks.forEach(function(trackData,i){var track=new __WEBPACK_IMPORTED_MODULE_3__Track__["a"]();track.id=i;_this2.tracks.push(track);var absoluteTime=0;trackData.forEach(function(event){absoluteTime+=__WEBPACK_IMPORTED_MODULE_2__Util__["a"](event.deltaTime,_this2.header);if(event.type==='meta'&&event.subtype==='trackName'){track.name=__WEBPACK_IMPORTED_MODULE_2__Util__["b"](event.text);}else if(event.subtype==='noteOn'){track.noteOn(event.noteNumber,absoluteTime,event.velocity/127);if(track.channelNumber===-1){track.channelNumber=event.channel;}}else if(event.subtype==='noteOff'){track.noteOff(event.noteNumber,absoluteTime);}else if(event.subtype==='controller'&&event.controllerType){track.cc(event.controllerType,absoluteTime,event.value/127);}else if(event.type==='meta'&&event.subtype==='instrumentName'){track.instrument=event.text;}else if(event.type==='channel'&&event.subtype==='programChange'){track.patch(event.programNumber);track.channelNumber=event.channel;}});if(!_this2.header.name&&!track.length&&track.name){_this2.header.name=track.name;}});return this;}},{key:'encode',value:function encode(){var _this3=this;var output=new __WEBPACK_IMPORTED_MODULE_1_jsmidgen__["File"]({ticks:this.header.PPQ});var firstEmptyTrack=this.tracks.filter(function(track){return!track.length;})[0];if(this.header.name&&!(firstEmptyTrack&&firstEmptyTrack.name===this.header.name)){var track=output.addTrack();track.addEvent(new __WEBPACK_IMPORTED_MODULE_1_jsmidgen__["MetaEvent"]({time:0,type:__WEBPACK_IMPORTED_MODULE_1_jsmidgen__["MetaEvent"].TRACK_NAME,data:this.header.name}));}
this.tracks.forEach(function(track){var trackEncoder=output.addTrack();trackEncoder.setTempo(_this3.bpm);if(track.name){trackEncoder.addEvent(new __WEBPACK_IMPORTED_MODULE_1_jsmidgen__["MetaEvent"]({time:0,type:__WEBPACK_IMPORTED_MODULE_1_jsmidgen__["MetaEvent"].TRACK_NAME,data:track.name}));}
track.encode(trackEncoder,_this3.header);});return output.toBytes();}},{key:'toArray',value:function toArray(){var encodedStr=this.encode();var buffer=new Array(encodedStr.length);for(var i=0;i<encodedStr.length;i++){buffer[i]=encodedStr.charCodeAt(i);}
return buffer;}},{key:'toJSON',value:function toJSON(){var ret={header:this.header,tempo:this.tempo,timeSignature:this.timeSign,startTime:this.startTime,duration:this.duration,tracks:(this.tracks||[]).map(function(track){return track.toJSON();})};if(!ret.header.name)ret.header.name='';return ret;}},{key:'track',value:function track(name){var track=new __WEBPACK_IMPORTED_MODULE_3__Track__["a"](name);this.tracks.push(track);return track;}},{key:'get',value:function get(trackName){if(__WEBPACK_IMPORTED_MODULE_2__Util__["c"](trackName)){return this.tracks[trackName];}else{return this.tracks.find(function(t){return t.name===trackName;});}}},{key:'slice',value:function slice(){var startTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var endTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.duration;var midi=new Midi();midi.header=this.header;midi.tracks=this.tracks.map(function(t){return t.slice(startTime,endTime);});return midi;}},{key:'startTime',get:function get(){var startTimes=this.tracks.map(function(t){return t.startTime;});if(!startTimes.length)return 0;return Math.min.apply(Math,startTimes)||0;}},{key:'bpm',get:function get(){return this.header.bpm;},set:function set(bpm){var prevTempo=this.header.bpm;this.header.bpm=100;var ratio=prevTempo/bpm;this.tracks.forEach(function(track){return track.scale(ratio);});}},{key:'timeSignature',get:function get(){return this.header.timeSignature;},set:function set(timeSig){this.header.timeSignature=timeSig;}},{key:'duration',get:function get(){var durations=this.tracks.map(function(t){return t.duration;});if(!durations.length)return 0;return Math.max.apply(Math,durations)||0;}}]);return Midi;}();}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return BinaryInsert;});function findElement(array,time){var beginning=0;var len=array.length;var end=len;if(len>0&&array[len-1].time<=time){return len-1;}
while(beginning<end){var midPoint=Math.floor(beginning+(end-beginning)/2);var event=array[midPoint];var nextEvent=array[midPoint+1];if(event.time===time){for(var i=midPoint;i<array.length;i++){var testEvent=array[i];if(testEvent.time===time){midPoint=i;}}
return midPoint;}else if(event.time<time&&nextEvent.time>time){return midPoint;}else if(event.time>time){end=midPoint;}else if(event.time<time){beginning=midPoint+1;}}
return-1;}
function BinaryInsert(array,event){if(array.length){var index=findElement(array,event.time);array.splice(index+1,0,event);}else{array.push(event);}}}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Control;});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var channelNames={"1":"modulationWheel","2":"breath","4":"footController","5":"portamentoTime","7":"volume","8":"balance","10":"pan","64":"sustain","65":"portamentoTime","66":"sostenuto","67":"softPedal","68":"legatoFootswitch","84":"portamentoContro"};var Control=function(){function Control(number,time,value){_classCallCheck(this,Control);this.number=number;this.time=time;this.value=value;}
_createClass(Control,[{key:"name",get:function get(){if(channelNames.hasOwnProperty(this.number)){return channelNames[this.number];}}}]);return Control;}();}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return parseHeader;});__webpack_require__.d(__webpack_exports__,"b",function(){return parseTempo;});__webpack_require__.d(__webpack_exports__,"c",function(){return parseTimeSignature;});var __WEBPACK_IMPORTED_MODULE_0__Util__=__webpack_require__(0);function parseHeader(midiJson){var ret={PPQ:midiJson.header.ticksPerBeat};for(var i=0;i<midiJson.tracks.length;i++){var track=midiJson.tracks[i];for(var j=0;j<track.length;j++){var datum=track[j];if(datum.type==="meta"){if(datum.subtype==="timeSignature"){ret.timeSignature=[datum.numerator,datum.denominator];}else if(datum.subtype==="setTempo"){console.log(datum);if(!ret.bpm){ret.bpm=60000000/datum.microsecondsPerBeat;}}}}}
ret.bpm=ret.bpm||120;return ret;}
function parseTempo(midiJson,header){var ret=[];var t=0;var absoluteTime=0;for(var i=0;i<midiJson.tracks.length;i++){var track=midiJson.tracks[i];for(var j=0;j<track.length;j++){var datum=track[j];t+=datum.deltaTime;absoluteTime+=__WEBPACK_IMPORTED_MODULE_0__Util__["a"](datum.deltaTime,header);if(datum.type==="meta"){if(datum.subtype==="timeSignature"){ret.timeSignature=[datum.numerator,datum.denominator];}else if(datum.subtype==="setTempo"){ret.push({"absoluteTime":t,"seconds":absoluteTime,"bpm":60000000/datum.microsecondsPerBeat});}}}}
return ret;}
function getBaseLog(x,y){return Math.log(y)/Math.log(x);}
function parseTimeSignature(midiJson,header){var ret=[];var t=0;var absoluteTime=0;for(var i=0;i<midiJson.tracks.length;i++){var track=midiJson.tracks[i];for(var j=0;j<track.length;j++){var datum=track[j];t+=datum.deltaTime;absoluteTime+=__WEBPACK_IMPORTED_MODULE_0__Util__["a"](datum.deltaTime,header);if(datum.type==="meta"){if(datum.subtype==="timeSignature"){console.log(datum);ret.push({"absoluteTime":t,"seconds":absoluteTime,"numerator":datum.numerator,"denominator":getBaseLog(2,datum.denominator),"click":datum.metronome,"notesQ":datum.thirtyseconds});}else if(datum.subtype==="setTempo"){}}}}
return ret;}}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Merge;});function hasMoreValues(arrays,positions){for(var i=0;i<arrays.length;i++){var arr=arrays[i];var pos=positions[i];if(arr.length>pos){return true;}}
return false;}
function getLowestAtPosition(arrays,positions,encoders){var lowestIndex=0;var lowestValue=Infinity;for(var i=0;i<arrays.length;i++){var arr=arrays[i];var pos=positions[i];if(arr[pos]&&arr[pos].time<lowestValue){lowestIndex=i;lowestValue=arr[pos].time;}}
encoders[lowestIndex](arrays[lowestIndex][positions[lowestIndex]]);positions[lowestIndex]+=1;}
function Merge(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}
var arrays=args.filter(function(v,i){return i%2===0;});var positions=new Uint32Array(arrays.length);var encoders=args.filter(function(v,i){return i%2===1;});var output=[];while(hasMoreValues(arrays,positions)){getLowestAtPosition(arrays,positions,encoders);}}}),(function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:true});__webpack_exports__["parse"]=parse;__webpack_exports__["load"]=load;__webpack_exports__["create"]=create;__webpack_exports__["fromJSON"]=fromJSON;var __WEBPACK_IMPORTED_MODULE_0__Midi__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_1__instrumentMaps__=__webpack_require__(1);__webpack_require__.d(__webpack_exports__,"instrumentByPatchID",function(){return __WEBPACK_IMPORTED_MODULE_1__instrumentMaps__["a"];});__webpack_require__.d(__webpack_exports__,"instrumentFamilyByID",function(){return __WEBPACK_IMPORTED_MODULE_1__instrumentMaps__["b"];});__webpack_require__.d(__webpack_exports__,"drumKitByPatchID",function(){return __WEBPACK_IMPORTED_MODULE_1__instrumentMaps__["c"];});function parse(fileBlob){return new __WEBPACK_IMPORTED_MODULE_0__Midi__["a"]().decode(fileBlob);}
function load(url,callback){var promise=new __WEBPACK_IMPORTED_MODULE_0__Midi__["a"]().load(url);if(callback){promise.then(callback);}
return promise;}
function create(){return new __WEBPACK_IMPORTED_MODULE_0__Midi__["a"]();}
function fromJSON(json){return __WEBPACK_IMPORTED_MODULE_0__Midi__["a"].fromJSON(json);}}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Note;});var __WEBPACK_IMPORTED_MODULE_0__Util__=__webpack_require__(0);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Note=function(){_createClass(Note,null,[{key:'fromJSON',value:function fromJSON(json){var note=new Note(json.midi,json.time,json.duration,json.velocity);return note;}}]);function Note(midi,time){var duration=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var velocity=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Note);if(__WEBPACK_IMPORTED_MODULE_0__Util__["c"](midi)){this.midi=midi;}else if(__WEBPACK_IMPORTED_MODULE_0__Util__["d"](midi)){this.name=midi;}else{throw new Error('the midi value must either be in Pitch Notation (e.g. C#4) or a midi value');}
this.time=time;this.duration=duration;this.velocity=velocity;}
_createClass(Note,[{key:'match',value:function match(note){if(__WEBPACK_IMPORTED_MODULE_0__Util__["c"](note)){return this.midi===note;}else if(__WEBPACK_IMPORTED_MODULE_0__Util__["d"](note)){return this.name.toLowerCase()===note.toLowerCase();}}},{key:'toJSON',value:function toJSON(){return{name:this.name,midi:this.midi,time:this.time,velocity:this.velocity,duration:this.duration};}},{key:'name',get:function get(){return __WEBPACK_IMPORTED_MODULE_0__Util__["e"](this.midi);},set:function set(name){this.midi=__WEBPACK_IMPORTED_MODULE_0__Util__["f"](name);}},{key:'noteOn',get:function get(){return this.time;},set:function set(t){this.time=t;}},{key:'noteOff',get:function get(){return this.time+this.duration;},set:function set(time){this.duration=time-this.time;}}]);return Note;}();}),(function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Track;});var __WEBPACK_IMPORTED_MODULE_0__BinaryInsert__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_1__Control__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_2__Merge__=__webpack_require__(6);var __WEBPACK_IMPORTED_MODULE_3__Note__=__webpack_require__(8);var __WEBPACK_IMPORTED_MODULE_4__instrumentMaps__=__webpack_require__(1);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var Track=function(){_createClass(Track,null,[{key:'fromJSON',value:function fromJSON(json){var track=new Track(json.name,json.instrumentNumber,json.channelNumber);track.id=json.id;if(json.notes){json.notes.forEach(function(note){var newNote=__WEBPACK_IMPORTED_MODULE_3__Note__["a"].fromJSON(note);track.notes.push(newNote);});}
if(json.controlChanges){track.controlChanges=json.controlChanges;}
return track;}}]);function Track(name){var instrumentNumber=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var channel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;_classCallCheck(this,Track);this.name=name;this.channelNumber=channel;this.notes=[];this.controlChanges={};this.instrumentNumber=instrumentNumber;}
_createClass(Track,[{key:'note',value:function note(midi,time){var duration=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var velocity=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var note=new __WEBPACK_IMPORTED_MODULE_3__Note__["a"](midi,time,duration,velocity);__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__BinaryInsert__["a"])(this.notes,note);return this;}},{key:'noteOn',value:function noteOn(midi,time){var velocity=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var note=new __WEBPACK_IMPORTED_MODULE_3__Note__["a"](midi,time,0,velocity);__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__BinaryInsert__["a"])(this.notes,note);return this;}},{key:'noteOff',value:function noteOff(midi,time){for(var i=0;i<this.notes.length;i++){var note=this.notes[i];if(note.match(midi)&&note.duration===0){note.noteOff=time;break;}}
return this;}},{key:'cc',value:function cc(num,time,value){if(!this.controlChanges.hasOwnProperty(num)){this.controlChanges[num]=[];}
var cc=new __WEBPACK_IMPORTED_MODULE_1__Control__["a"](num,time,value);__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0__BinaryInsert__["a"])(this.controlChanges[num],cc);return this;}},{key:'patch',value:function patch(id){this.instrumentNumber=id;return this;}},{key:'channel',value:function channel(id){this.channelNumber=id;return this;}},{key:'scale',value:function scale(amount){this.notes.forEach(function(note){note.time*=amount;note.duration*=amount;});return this;}},{key:'slice',value:function slice(){var startTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var endTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.duration;var noteStartIndex=Math.max(this.notes.findIndex(function(note){return note.time>=startTime;}),0);var noteEndIndex=this.notes.findIndex(function(note){return note.noteOff>=endTime;})+1;var track=new Track(this.name);track.notes=this.notes.slice(noteStartIndex,noteEndIndex);track.notes.forEach(function(note){return note.time=note.time-startTime;});return track;}},{key:'encode',value:function encode(trackEncoder,header){var ticksPerSecond=header.PPQ/(60/header.bpm);var lastEventTime=0;var channelNumber=Math.max(0,this.channelNumber);function getDeltaTime(time){var ticks=Math.floor(ticksPerSecond*time);var delta=Math.max(ticks-lastEventTime,0);lastEventTime=ticks;return delta;}
if(this.instrumentNumber!==-1){trackEncoder.instrument(channelNumber,this.instrumentNumber);}
__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__Merge__["a"])(this.noteOns.sort(function(a,b){return a.time-b.time;}),function(noteOn){trackEncoder.addNoteOn(channelNumber,noteOn.name,getDeltaTime(noteOn.time),Math.floor(noteOn.velocity*127));},this.noteOffs.sort(function(a,b){return a.time-b.time;}),function(noteOff){trackEncoder.addNoteOff(channelNumber,noteOff.name,getDeltaTime(noteOff.time));});}},{key:'toJSON',value:function toJSON(){var ret={startTime:this.startTime,duration:this.duration,length:this.length,notes:[],controlChanges:{}};if(typeof this.id!=='undefined')ret.id=this.id;ret.name=this.name;if(this.instrumentNumber!==-1){ret.instrumentNumber=this.instrumentNumber;ret.instrument=this.instrument;ret.instrumentFamily=this.instrumentFamily;}
if(this.channelNumber!==-1){ret.channelNumber=this.channelNumber;ret.isPercussion=this.isPercussion;}
if(this.notes.length)ret.notes=this.notes.map(function(n){return n.toJSON();});if(Object.keys(this.controlChanges).length)ret.controlChanges=this.controlChanges;return ret;}},{key:'noteOns',get:function get(){var noteOns=[];this.notes.forEach(function(note){noteOns.push({time:note.noteOn,midi:note.midi,name:note.name,velocity:note.velocity});});return noteOns;}},{key:'noteOffs',get:function get(){var noteOffs=[];this.notes.forEach(function(note){noteOffs.push({time:note.noteOff,midi:note.midi,name:note.name});});return noteOffs;}},{key:'length',get:function get(){return this.notes.length;}},{key:'startTime',get:function get(){if(this.notes.length){var firstNote=this.notes[0];return firstNote.noteOn;}else{return 0;}}},{key:'duration',get:function get(){if(this.notes.length){var lastNote=this.notes[this.notes.length-1];return lastNote.noteOff;}else{return 0;}}},{key:'instrument',get:function get(){if(this.isPercussion){return __WEBPACK_IMPORTED_MODULE_4__instrumentMaps__["c"][this.instrumentNumber];}else{return __WEBPACK_IMPORTED_MODULE_4__instrumentMaps__["a"][this.instrumentNumber];}},set:function set(inst){var index=__WEBPACK_IMPORTED_MODULE_4__instrumentMaps__["a"].indexOf(inst);if(index!==-1){this.instrumentNumber=index;}}},{key:'isPercussion',get:function get(){return[0x9,0xA].includes(this.channelNumber);}},{key:'instrumentFamily',get:function get(){if(this.isPercussion){return 'drums';}else{return __WEBPACK_IMPORTED_MODULE_4__instrumentMaps__["b"][Math.floor(this.instrumentNumber/8)];}}}]);return Track;}();}),(function(module,exports,__webpack_require__){(function(module){var Midi={};(function(exported){var DEFAULT_VOLUME=exported.DEFAULT_VOLUME=90;var DEFAULT_DURATION=exported.DEFAULT_DURATION=128;var DEFAULT_CHANNEL=exported.DEFAULT_CHANNEL=0;var Util={midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(n){var matches=/([a-g])(#+|b+)?([0-9]+)$/i.exec(n);var note=matches[1].toLowerCase(),accidental=matches[2]||'',octave=parseInt(matches[3],10);return(12*octave)+Util.midi_letter_pitches[note]+(accidental.substr(0,1)=='#'?1:-1)*accidental.length;},ensureMidiPitch:function(p){if(typeof p=='number'||!/[^0-9]/.test(p)){return parseInt(p,10);}else{return Util.midiPitchFromNote(p);}},midi_pitches_letter:{'12':'c','13':'c#','14':'d','15':'d#','16':'e','17':'f','18':'f#','19':'g','20':'g#','21':'a','22':'a#','23':'b'},midi_flattened_notes:{'a#':'bb','c#':'db','d#':'eb','f#':'gb','g#':'ab'},noteFromMidiPitch:function(n,returnFlattened){var octave=0,noteNum=n,noteName,returnFlattened=returnFlattened||false;if(n>23){octave=Math.floor(n/12)-1;noteNum=n-octave*12;}
noteName=Util.midi_pitches_letter[noteNum];if(returnFlattened&&noteName.indexOf('#')>0){noteName=Util.midi_flattened_notes[noteName];}
return noteName+octave;},mpqnFromBpm:function(bpm){var mpqn=Math.floor(60000000/bpm);var ret=[];do{ret.unshift(mpqn&0xFF);mpqn>>=8;}while(mpqn);while(ret.length<3){ret.push(0);}
return ret;},bpmFromMpqn:function(mpqn){var m=mpqn;if(typeof mpqn[0]!='undefined'){m=0;for(var i=0,l=mpqn.length-1;l>=0;++i,--l){m|=mpqn[i]<<l;}}
return Math.floor(60000000/mpqn);},codes2Str:function(byteArray){return String.fromCharCode.apply(null,byteArray);},str2Bytes:function(str,finalBytes){if(finalBytes){while((str.length/2)<finalBytes){str="0"+str;}}
var bytes=[];for(var i=str.length-1;i>=0;i=i-2){var chars=i===0?str[i]:str[i-1]+str[i];bytes.unshift(parseInt(chars,16));}
return bytes;},translateTickTime:function(ticks){var buffer=ticks&0x7F;while(ticks=ticks>>7){buffer<<=8;buffer|=((ticks&0x7F)|0x80);}
var bList=[];while(true){bList.push(buffer&0xff);if(buffer&0x80){buffer>>=8;}
else{break;}}
return bList;},};var MidiEvent=function(params){if(!this)return new MidiEvent(params);if(params&&(params.type!==null||params.type!==undefined)&&(params.channel!==null||params.channel!==undefined)&&(params.param1!==null||params.param1!==undefined)){this.setTime(params.time);this.setType(params.type);this.setChannel(params.channel);this.setParam1(params.param1);this.setParam2(params.param2);}};MidiEvent.NOTE_OFF=0x80;MidiEvent.NOTE_ON=0x90;MidiEvent.AFTER_TOUCH=0xA0;MidiEvent.CONTROLLER=0xB0;MidiEvent.PROGRAM_CHANGE=0xC0;MidiEvent.CHANNEL_AFTERTOUCH=0xD0;MidiEvent.PITCH_BEND=0xE0;MidiEvent.prototype.setTime=function(ticks){this.time=Util.translateTickTime(ticks||0);};MidiEvent.prototype.setType=function(type){if(type<MidiEvent.NOTE_OFF||type>MidiEvent.PITCH_BEND){throw new Error("Trying to set an unknown event: "+type);}
this.type=type;};MidiEvent.prototype.setChannel=function(channel){if(channel<0||channel>15){throw new Error("Channel is out of bounds.");}
this.channel=channel;};MidiEvent.prototype.setParam1=function(p){this.param1=p;};MidiEvent.prototype.setParam2=function(p){this.param2=p;};MidiEvent.prototype.toBytes=function(){var byteArray=[];var typeChannelByte=this.type|(this.channel&0xF);byteArray.push.apply(byteArray,this.time);byteArray.push(typeChannelByte);byteArray.push(this.param1);if(this.param2!==undefined&&this.param2!==null){byteArray.push(this.param2);}
return byteArray;};var MetaEvent=function(params){if(!this)return new MetaEvent(params);var p=params||{};this.setTime(params.time);this.setType(params.type);this.setData(params.data);};MetaEvent.SEQUENCE=0x00;MetaEvent.TEXT=0x01;MetaEvent.COPYRIGHT=0x02;MetaEvent.TRACK_NAME=0x03;MetaEvent.INSTRUMENT=0x04;MetaEvent.LYRIC=0x05;MetaEvent.MARKER=0x06;MetaEvent.CUE_POINT=0x07;MetaEvent.CHANNEL_PREFIX=0x20;MetaEvent.END_OF_TRACK=0x2f;MetaEvent.TEMPO=0x51;MetaEvent.SMPTE=0x54;MetaEvent.TIME_SIG=0x58;MetaEvent.KEY_SIG=0x59;MetaEvent.SEQ_EVENT=0x7f;MetaEvent.prototype.setTime=function(ticks){this.time=Util.translateTickTime(ticks||0);};MetaEvent.prototype.setType=function(t){this.type=t;};MetaEvent.prototype.setData=function(d){this.data=d;};MetaEvent.prototype.toBytes=function(){if(!this.type){throw new Error("Type for meta-event not specified.");}
var byteArray=[];byteArray.push.apply(byteArray,this.time);byteArray.push(0xFF,this.type);if(Array.isArray(this.data)){byteArray.push(this.data.length);byteArray.push.apply(byteArray,this.data);}else if(typeof this.data=='number'){byteArray.push(1,this.data);}else if(this.data!==null&&this.data!==undefined){byteArray.push(this.data.length);var dataBytes=this.data.split('').map(function(x){return x.charCodeAt(0)});byteArray.push.apply(byteArray,dataBytes);}else{byteArray.push(0);}
return byteArray;};var Track=function(config){if(!this)return new Track(config);var c=config||{};this.events=c.events||[];};Track.START_BYTES=[0x4d,0x54,0x72,0x6b];Track.END_BYTES=[0x00,0xFF,0x2F,0x00];Track.prototype.addEvent=function(event){this.events.push(event);return this;};Track.prototype.addNoteOn=Track.prototype.noteOn=function(channel,pitch,time,velocity){this.events.push(new MidiEvent({type:MidiEvent.NOTE_ON,channel:channel,param1:Util.ensureMidiPitch(pitch),param2:velocity||DEFAULT_VOLUME,time:time||0,}));return this;};Track.prototype.addNoteOff=Track.prototype.noteOff=function(channel,pitch,time,velocity){this.events.push(new MidiEvent({type:MidiEvent.NOTE_OFF,channel:channel,param1:Util.ensureMidiPitch(pitch),param2:velocity||DEFAULT_VOLUME,time:time||0,}));return this;};Track.prototype.addNote=Track.prototype.note=function(channel,pitch,dur,time,velocity){this.noteOn(channel,pitch,time,velocity);if(dur){this.noteOff(channel,pitch,dur,velocity);}
return this;};Track.prototype.addChord=Track.prototype.chord=function(channel,chord,dur,velocity){if(!Array.isArray(chord)&&!chord.length){throw new Error('Chord must be an array of pitches');}
chord.forEach(function(note){this.noteOn(channel,note,0,velocity);},this);chord.forEach(function(note,index){if(index===0){this.noteOff(channel,note,dur);}else{this.noteOff(channel,note);}},this);return this;};Track.prototype.setInstrument=Track.prototype.instrument=function(channel,instrument,time){this.events.push(new MidiEvent({type:MidiEvent.PROGRAM_CHANGE,channel:channel,param1:instrument,time:time||0,}));return this;};Track.prototype.setTempo=Track.prototype.tempo=function(bpm,time){this.events.push(new MetaEvent({type:MetaEvent.TEMPO,data:Util.mpqnFromBpm(bpm),time:time||0,}));return this;};Track.prototype.toBytes=function(){var trackLength=0;var eventBytes=[];var startBytes=Track.START_BYTES;var endBytes=Track.END_BYTES;var addEventBytes=function(event){var bytes=event.toBytes();trackLength+=bytes.length;eventBytes.push.apply(eventBytes,bytes);};this.events.forEach(addEventBytes);trackLength+=endBytes.length;var lengthBytes=Util.str2Bytes(trackLength.toString(16),4);return startBytes.concat(lengthBytes,eventBytes,endBytes);};var File=function(config){if(!this)return new File(config);var c=config||{};if(c.ticks){if(typeof c.ticks!=='number'){throw new Error('Ticks per beat must be a number!');return;}
if(c.ticks<=0||c.ticks>=(1<<15)||c.ticks%1!==0){throw new Error('Ticks per beat must be an integer between 1 and 32767!');return;}}
this.ticks=c.ticks||128;this.tracks=c.tracks||[];};File.HDR_CHUNKID="MThd";File.HDR_CHUNK_SIZE="\x00\x00\x00\x06";File.HDR_TYPE0="\x00\x00";File.HDR_TYPE1="\x00\x01";File.prototype.addTrack=function(track){if(track){this.tracks.push(track);return this;}else{track=new Track();this.tracks.push(track);return track;}};File.prototype.toBytes=function(){var trackCount=this.tracks.length.toString(16);var bytes=File.HDR_CHUNKID+File.HDR_CHUNK_SIZE;if(parseInt(trackCount,16)>1){bytes+=File.HDR_TYPE1;}else{bytes+=File.HDR_TYPE0;}
bytes+=Util.codes2Str(Util.str2Bytes(trackCount,2));bytes+=String.fromCharCode((this.ticks/256),this.ticks%256);;this.tracks.forEach(function(track){bytes+=Util.codes2Str(track.toBytes());});return bytes;};exported.Util=Util;exported.File=File;exported.Track=Track;exported.Event=MidiEvent;exported.MetaEvent=MetaEvent;})(Midi);if(typeof module!='undefined'&&module!==null){module.exports=Midi;}else if(typeof exports!='undefined'&&exports!==null){exports=Midi;}else{this.Midi=Midi;}}.call(exports,__webpack_require__(12)(module)))}),(function(module,exports){module.exports=function(file){return MidiFile(file)};function MidiFile(data){function readChunk(stream){var id=stream.read(4);var length=stream.readInt32();return{'id':id,'length':length,'data':stream.read(length)};}
var lastEventTypeByte;function readEvent(stream){var event={};event.deltaTime=stream.readVarInt();var eventTypeByte=stream.readInt8();if((eventTypeByte&0xf0)==0xf0){if(eventTypeByte==0xff){event.type='meta';var subtypeByte=stream.readInt8();var length=stream.readVarInt();switch(subtypeByte){case 0x00:event.subtype='sequenceNumber';if(length!=2)throw "Expected length for sequenceNumber event is 2, got "+length;event.number=stream.readInt16();return event;case 0x01:event.subtype='text';event.text=stream.read(length);return event;case 0x02:event.subtype='copyrightNotice';event.text=stream.read(length);return event;case 0x03:event.subtype='trackName';event.text=stream.read(length);return event;case 0x04:event.subtype='instrumentName';event.text=stream.read(length);return event;case 0x05:event.subtype='lyrics';event.text=stream.read(length);return event;case 0x06:event.subtype='marker';event.text=stream.read(length);return event;case 0x07:event.subtype='cuePoint';event.text=stream.read(length);return event;case 0x20:event.subtype='midiChannelPrefix';if(length!=1)throw "Expected length for midiChannelPrefix event is 1, got "+length;event.channel=stream.readInt8();return event;case 0x2f:event.subtype='endOfTrack';if(length!=0)throw "Expected length for endOfTrack event is 0, got "+length;return event;case 0x51:event.subtype='setTempo';if(length!=3)throw "Expected length for setTempo event is 3, got "+length;event.microsecondsPerBeat=((stream.readInt8()<<16)
+(stream.readInt8()<<8)
+stream.readInt8())
return event;case 0x54:event.subtype='smpteOffset';if(length!=5)throw "Expected length for smpteOffset event is 5, got "+length;var hourByte=stream.readInt8();event.frameRate={0x00:24,0x20:25,0x40:29,0x60:30}[hourByte&0x60];event.hour=hourByte&0x1f;event.min=stream.readInt8();event.sec=stream.readInt8();event.frame=stream.readInt8();event.subframe=stream.readInt8();return event;case 0x58:event.subtype='timeSignature';if(length!=4)throw "Expected length for timeSignature event is 4, got "+length;event.numerator=stream.readInt8();event.denominator=Math.pow(2,stream.readInt8());event.metronome=stream.readInt8();event.thirtyseconds=stream.readInt8();return event;case 0x59:event.subtype='keySignature';if(length!=2)throw "Expected length for keySignature event is 2, got "+length;event.key=stream.readInt8(true);event.scale=stream.readInt8();return event;case 0x7f:event.subtype='sequencerSpecific';event.data=stream.read(length);return event;default:event.subtype='unknown'
event.data=stream.read(length);return event;}
event.data=stream.read(length);return event;}else if(eventTypeByte==0xf0){event.type='sysEx';var length=stream.readVarInt();event.data=stream.read(length);return event;}else if(eventTypeByte==0xf7){event.type='dividedSysEx';var length=stream.readVarInt();event.data=stream.read(length);return event;}else{throw "Unrecognised MIDI event type byte: "+eventTypeByte;}}else{var param1;if((eventTypeByte&0x80)==0){param1=eventTypeByte;eventTypeByte=lastEventTypeByte;}else{param1=stream.readInt8();lastEventTypeByte=eventTypeByte;}
var eventType=eventTypeByte>>4;event.channel=eventTypeByte&0x0f;event.type='channel';switch(eventType){case 0x08:event.subtype='noteOff';event.noteNumber=param1;event.velocity=stream.readInt8();return event;case 0x09:event.noteNumber=param1;event.velocity=stream.readInt8();if(event.velocity==0){event.subtype='noteOff';}else{event.subtype='noteOn';}
return event;case 0x0a:event.subtype='noteAftertouch';event.noteNumber=param1;event.amount=stream.readInt8();return event;case 0x0b:event.subtype='controller';event.controllerType=param1;event.value=stream.readInt8();return event;case 0x0c:event.subtype='programChange';event.programNumber=param1;return event;case 0x0d:event.subtype='channelAftertouch';event.amount=param1;return event;case 0x0e:event.subtype='pitchBend';event.value=param1+(stream.readInt8()<<7);return event;default:throw "Unrecognised MIDI event type: "+eventType}}}
stream=Stream(data);var headerChunk=readChunk(stream);if(headerChunk.id!='MThd'||headerChunk.length!=6){throw "Bad .mid file - header not found";}
var headerStream=Stream(headerChunk.data);var formatType=headerStream.readInt16();var trackCount=headerStream.readInt16();var timeDivision=headerStream.readInt16();if(timeDivision&0x8000){throw "Expressing time division in SMTPE frames is not supported yet"}else{ticksPerBeat=timeDivision;}
var header={'formatType':formatType,'trackCount':trackCount,'ticksPerBeat':ticksPerBeat}
var tracks=[];for(var i=0;i<header.trackCount;i++){tracks[i]=[];var trackChunk=readChunk(stream);if(trackChunk.id!='MTrk'){throw "Unexpected chunk - expected MTrk, got "+trackChunk.id;}
var trackStream=Stream(trackChunk.data);while(!trackStream.eof()){var event=readEvent(trackStream);tracks[i].push(event);}}
return{'header':header,'tracks':tracks}};function Stream(str){var position=0;function read(length){var result=str.substr(position,length);position+=length;return result;}
function readInt32(){var result=((str.charCodeAt(position)<<24)
+(str.charCodeAt(position+1)<<16)
+(str.charCodeAt(position+2)<<8)
+str.charCodeAt(position+3));position+=4;return result;}
function readInt16(){var result=((str.charCodeAt(position)<<8)
+str.charCodeAt(position+1));position+=2;return result;}
function readInt8(signed){var result=str.charCodeAt(position);if(signed&&result>127)result-=256;position+=1;return result;}
function eof(){return position>=str.length;}
function readVarInt(){var result=0;while(true){var b=readInt8();if(b&0x80){result+=(b&0x7f);result<<=7;}else{return result+b;}}}
return{'eof':eof,'read':read,'readInt32':readInt32,'readInt16':readInt16,'readInt8':readInt8,'readVarInt':readVarInt}}}),(function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];if(!module.children)module.children=[];Object.defineProperty(module,"loaded",{enumerable:true,get:function(){return module.l;}});Object.defineProperty(module,"id",{enumerable:true,get:function(){return module.i;}});module.webpackPolyfill=1;}
return module;};})]);});